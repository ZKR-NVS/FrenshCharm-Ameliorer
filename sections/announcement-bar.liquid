{{ 'component-slideshow.s.min.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.s.min.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign social_icons = true
  if settings.social_facebook_link == blank and settings.social_instagram_link == blank and settings.social_youtube_link == blank and settings.social_tiktok_link == blank and settings.social_twitter_link == blank and settings.social_pinterest_link == blank and settings.social_snapchat_link == blank and settings.social_tumblr_link == blank and settings.social_vimeo_link == blank
    assign social_icons = false
  endif
  if section.settings.enable_country_selector or section.settings.enable_language_selector
    assign language_country_selector = true
  endif
  if section.blocks.size > 0
    assign announcement_bar = true
  endif
-%}

{% if social_icons %}
  {{ 'component-list-social.s.min.css' | asset_url | stylesheet_tag }}
{% endif %}

<div
  class="utility-bar color-{{ section.settings.color_scheme }} gradient{% if section.settings.show_line_separator and section.blocks.size > 0 %} utility-bar--bottom-border{% elsif section.settings.show_line_separator and section.settings.show_social and social_icons%} utility-bar--bottom-border-social-only{% endif %}{% if section.settings.enable_country_selector or section.settings.enable_language_selector %} header-localization{% endif %}"
  {{ block.shopify_attributes }}
>
  <div class="page-width utility-bar__grid{% if announcement_bar and language_country_selector or section.settings.show_social and social_icons %} utility-bar__grid--3-col{% elsif language_country_selector or section.settings.show_social and social_icons %} utility-bar__grid--2-col{% endif %}">
    {%- if section.settings.show_social and social_icons -%}
      {%- render 'social-icons' -%}
    {%- endif -%}
    {%- if section.blocks.size > 0 -%}
      <div class="announcement-bar color-{{ section.settings.color_scheme }}" role="region" aria-label="{{ 'sections.header.announcement' | t }}">
        <div class="page-width">
          <div class="announcement-slider">
            {%- for block in section.blocks -%}
              <div class="announcement-slide{% if forloop.first %} active{% endif %}" {{ block.shopify_attributes }}>
                {%- if block.settings.link != blank -%}
                  <a href="{{ block.settings.link }}" class="announcement-bar__link">
                {%- endif -%}
                  <p class="announcement-bar__message">
                    {{ block.settings.text | escape }}
                  </p>
                {%- if block.settings.link != blank -%}
                  </a>
                {%- endif -%}
              </div>
            {%- endfor -%}
          </div>
        </div>
      </div>

      <style>
        .announcement-bar {
          background-color: {{ section.settings.background }};
          padding: 10px 0;
        }
        .announcement-slider {
          position: relative;
          text-align: center;
        }
        .announcement-slide {
          display: none;
          width: 100%;
        }
        .announcement-slide.active {
          display: block;
        }
        .announcement-bar__message {
          margin: 0;
          padding: 0;
          color: {{ section.settings.text_color }};
        }
        .announcement-bar__link {
          text-decoration: none;
          color: inherit;
        }
      </style>

      {%- if section.blocks.size > 1 and section.settings.auto_rotate -%}
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            const slides = document.querySelectorAll('.announcement-slide');
            let currentSlide = 0;
            const speed = {{ section.settings.change_slides_speed }};

            function showSlide(index) {
              slides.forEach(slide => slide.classList.remove('active'));
              slides[index].classList.add('active');
            }

            if (slides.length > 1) {
              setInterval(() => {
                currentSlide = (currentSlide + 1) % slides.length;
                showSlide(currentSlide);
              }, speed * 1000);
            }
          });
        </script>
      {%- endif -%}
    {%- endif -%}
    <div class="localization-wrapper">
      {%- if section.settings.enable_country_selector and localization.available_countries.size > 1 -%}
        <localization-form class="small-hide medium-hide">
          {%- form 'localization', id: 'AnnouncementCountryForm', class: 'localization-form' -%}
            <div>
              <h2 class="visually-hidden" id="AnnouncementCountryLabel">{{ 'localization.country_label' | t }}</h2>
              {%- render 'country-localization', localPosition: 'AnnouncementCountry' -%}
            </div>
          {%- endform -%}
        </localization-form>
      {% endif %}

      {%- if section.settings.enable_language_selector and localization.available_languages.size > 1 -%}
        <localization-form class="small-hide medium-hide">
          {%- form 'localization', id: 'AnnouncementLanguageForm', class: 'localization-form' -%}
            <div>
              <h2 class="visually-hidden" id="AnnouncementLanguageLabel">{{ 'localization.language_label' | t }}</h2>
              {%- render 'language-localization', localPosition: 'AnnouncementLanguage' -%}
            </div>
          {%- endform -%}
        </localization-form>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Barre d'annonce",
  "max_blocks": 5,
  "settings": [
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Rotation automatique",
      "default": true
    },
    {
      "type": "range",
      "id": "change_slides_speed",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Changer toutes les",
      "default": 5
    },
    {
      "type": "color",
      "id": "background",
      "label": "Couleur de fond",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Couleur du texte",
      "default": "#FFFFFF"
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Annonce",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Texte",
          "default": "ðŸ”¥ OFFRE LIMITÃ‰E : -10% avec le code WELCOME10"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Lien (optionnel)"
        }
      ]
    }
  ]
}
{% endschema %}
